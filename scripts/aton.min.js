"use strict";function ATON(){return this.options={},this}ATON.prototype.defaultOptions={recordTerminator:"\n",metaMarker:"@@",objectBegin:["BEGIN","START"],objectEnd:["END","STOP"],commentMarker:"^@{5,}|^@{1,4}[^@]|^@{,4}$",keyMarker:"@",keyTerminator:"s*:s*",keyTerminatorOut:":	",forceKeyCase:"",forceType:void 0,onlyChildToRoot:!1},ATON.prototype.getOption=function(e){return this.options===void 0||"undefined"===this.options[e]?this.defaultOptions[e]:"object"==typeof this.options&&this.options[e]===void 0?this.defaultOptions[e]:this.options[e]},ATON.prototype.setOption=function(e,t){return this.options===void 0&&(this.options={}),this.options[e]=t,this},ATON.prototype.setLCKeys=function(){return this.setOption("forceKeyCase","lc"),this},ATON.prototype.setUCKeys=function(){return this.setOption("forceKeyCase","uc"),this},ATON.prototype.setOCKeys=function(){return this.setOption("forceKeyCase",""),this},ATON.prototype.unsetKeyCase=function(){this.setOCKeys()},ATON.prototype.setOnlyChildRoot=function(){this.setOption("onlyChildToRoot",!0)},ATON.prototype.unsetOnlyChildRoot=function(){this.setOption("onlyChildToRoot",!1)},ATON.prototype.getOptionString=function(e){var t=this.getOption(e);return"string"==typeof t?t:t instanceof Array?t.length?""+t[0]:"":"number"==typeof t?t+"":""},ATON.prototype.resetOptions=function(){this.options={}},ATON.prototype.parse=function(e){var t=this.parseRecordArray(e.split(/\n/));if(this.getOption("onlyChildToRoot")){var o=Object.keys(t);if(1===o.length&&"object"==typeof t[o[0]])return t[o[0]]}return t},ATON.prototype._initializeParsingStateVariables=function(){return{action:void 0,label:void 0,labelbegin:void 0,labelend:void 0,curobj:void 0,curobjname:void 0,curkey:void 0,newkey:void 0,newvalue:void 0,linenum:void 0,node:[],typer:{},output:{},keycase:this.getOptionString("forceKeyCase")}},ATON.prototype.parseRecordArray=function(e){if(!(e instanceof Array)||0===e.length||"string"!=typeof e[0])return{};var t=this._initializeParsingStateVariables();t.curobj=t.output;for(var o=0;e.length>o;o++){t.linenum=o+1;try{this._parseRecord(e[o],t)}catch(r){console.log(r),process.exit(1)}}var n=t;return this._cleanParameter(n),n.output},ATON.prototype._parseRecord=function(e,t){var o;if(!(e.match(/^@{5,}|^@+\s|^@{1,4}$/)||void 0===t.curkey&&e.match(/^[^@]|^$/)))if(o=e.match(/^@@[^@ ]/))if(this._cleanParameter(t),t.curkey=void 0,o=e.match(/^@@(BEGIN|START)\s*:\s*(.*)\s*$/i))t.label=o[2],t.curobj[t.label]===void 0?(t.curobj[t.label]={},t.node.push({label:t.label,startline:t.linenum}),t.curobj=t.curobj[t.label]):t.curobj[t.label]instanceof Array?(t.curobj[t.label].push({}),t.node.push({}),t.node[t.node.length-1].index=t.curobj[t.label].length-1,t.node[t.node.length-1].label=t.label,t.node[t.node.length-1].startline=t.linenum,t.curobj=t.curobj[t.label][t.curobj[t.label].length-1]):(t.curobj[t.label],t.curobj[t.label]=[t.curobj[t.label],{}],t.node.push({}),t.node[t.node.length-1].index=t.curobj[t.label].length-1,t.node[t.node.length-1].label=t.label,t.node[t.node.length-1].startline=t.linenum,t.curobj=t.curobj[t.label][t.curobj[t.label].length-1]);else if(o=e.match(/^@@(END|STOP)\s*:?\s*(.*)\s*$/i)){if(t.curkey!==void 0&&(t.curobj[t.curkey]=t.curobj[t.curkey].replace(/^\s+|\s+$/g,""),t.curkey=void 0),t.action=o[1],t.labelend=o[2],t.labelbegin=t.node[t.node.length-1].label,t.node[t.node.length-1].startline===void 0)throw Error("No start for "+t.action+" tag on line "+t.node[t.node.length-1].startline+": "+e);if(t.labelend!==void 0&&t.labelbegin!==t.labelend&&""!==t.labelend)throw Error("Labels do not match on lines "+t.node[t.node.length-1].startline+" and "+t.linenum+': "'+t.labelbegin+'" compared to "'+t.labelend+'".');if(!t.node)throw Error("Error on line "+t.linenum+": already at object root.");t.node.pop(),t.curobj=t.node.reduce(function(e,t){return e[t.label]instanceof Array?e[t.label][t.index]:e[t.label]},t.output)}else(o=e.match(/^@@TYPE\s*:\s*([^:]+)\s*:\s*(.*)\s*$/i))&&(t.typer[o[1]]=o[2]);else(o=e.match(/^@([^\s:@][^:]*)\s*:\s*(.*)\s*$/))?(t.newkey=o[1],t.newvalue=o[2],this._cleanParameter(t),t.curkey="uc"===t.keycase?t.newkey.toUpperCase():"lc"===t.keycase?t.newkey.toLowerCase():t.newkey,t.curobj[t.curkey]===void 0?t.curobj[t.curkey]=t.newvalue:t.curobj[t.curkey]instanceof Array?t.curobj[t.curkey].push(t.newvalue):t.curobj[t.curkey]=[t.curobj[t.curkey],t.newvalue]):t.curkey!==void 0&&"@"!==e.charAt(0)&&("\\@"===e.slice(0,2)&&(e=e.slice(1)),"\\\\@"===e.slice(0,3)&&(e=e.slice(1)),t.curobj[t.curkey]instanceof Array?t.curobj[t.curkey][t.curobj[t.curkey].length-1]+="\n"+e:t.curobj[t.curkey]+="\n"+e)},ATON.prototype._cleanParameter=function(e){if(e.curkey!==void 0&&e.curobj&&e.curobj[e.curkey]){var t;if(e.curobj[e.curkey]instanceof Array?t=e.curobj[e.curkey][e.curobj[e.curkey].length-1]:"string"==typeof e.curobj[e.curkey]&&(t=e.curobj[e.curkey]),t=t.replace(/^\s+|\s+$/g,""),e.typer&&e.typer[e.newkey]!==void 0){var o=e.typer[e.newkey];o.match(/number/i)?t=Number(t):o.match(/integer/i)?t=parseInt(t):o.match(/json/i)&&(t=JSON.parse(t))}e.curobj[e.curkey]instanceof Array?e.curobj[e.curkey][e.curobj[e.curkey].length-1]=t:"string"==typeof e.curobj[e.curkey]&&(e.curobj[e.curkey]=t)}},ATON.prototype.stringify=function(e,t){var o="";if("object"!=typeof e)return o;if(e instanceof Array)for(var r=0;e.length>r;r++)o+=this.stringify(e[r],t);else t&&(o+=this.getOptionString("metaMarker"),o+=this.getOptionString("objectBegin"),o+=this.getOptionString("keyTerminatorOut"),o+=t,o+=this.getOptionString("recordTerminator")),Object.keys(e).forEach(function(t){var r=e[t];if(!(r instanceof Function))if(r instanceof Array&&r.length)for(var n=0;r.length>n;n++)o+="object"==typeof r[n]?this.stringify(r[n],t):this._printSingleParameter(t,r[n]);else o+="object"==typeof r?this.stringify(r,t):this._printSingleParameter(t,r)},this),t&&(o+=this.getOptionString("metaMarker"),o+=this.getOptionString("objectEnd"),o+=this.getOptionString("keyTerminatorOut"),o+=t,o+=this.getOptionString("recordTerminator"));return o},ATON.prototype._printSingleParameter=function(e,t){var o="";return o+=this.getOptionString("keyMarker"),o+=e,o+=this.getOptionString("keyTerminatorOut"),o+=t,o+=this.getOptionString("recordTerminator")},"undefined"!=typeof module&&module.hasOwnProperty("exports")&&(module.exports=ATON);